<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <!-- 
        用于检查是否登入
    -->
    <script>
        //第三方页面跳转过来callback.html?redirect_uri=http://www.baidu.com
        //判断本地是否存在token
        //如果没有就跳转到login页面：从这里跳到登入页面在url上指定一个标记假设/login.html?redirect_uri=http://www.baidu.com&app_uri=callback.html
        //如果有（登入成功会跳过来），就调用/connect/authorize,获取code
        //跳转到第三方页面
    </script>
    <script>
        //代码仅供参考
        //获取url参数
        function GetQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]); return null;
        }
        //假设第三方跳过了来这样的：callback.html?redirect_uri=http://www.baidu.com
        var redirect_uri = GetQueryString("redirect_uri");
        var access_token = window.localStorage.getItem('access_token')
        if (access_token) {
            //如果有token,就获取一个授权码，并跳转回第三方
            $.ajax({
                url: '/connect/authorize',
                contentType: 'multipart/form-data;',
                data: {
                    redirect_uri: encodeURI(redirect_uri),//要对url进行编码
                    client_id: "client1"
                },
                headers: {
                    'authorization': "Bearer "+ access_token//注意Bearer后面的空格
                },
                success: function (res) {
                    var code = res.data.code;
                    var redirect_uri = res.data.redirect_uri;
                    window.location.href = redirect_uri + "?code=" + code;
                }
            });
        } else {
            //如果没token就去登入页登入
            
            window.location.href = '/login.html?redirect_uri=' + redirect_uri + '&callback=true';
        }
       
    </script>
</body>
</html>